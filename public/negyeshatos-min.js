(function(){var a,b=Object.prototype.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype;return a},d=function(a,b){return function(){return a.apply(b,arguments)}},e=Array.prototype.indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(this[b]===a)return b;return-1};a={"192.168.1.69:3000":"LKA10PKSU3VSYT1IONJK53LUAEEZQJQEZLZFTVG13K15FSWR"},$(document).ready(function(){var b,f,g,h,i,j,k,l,m,n,o,p,q;m=function(){function a(){a.__super__.constructor.apply(this,arguments)}c(a,Backbone.Model),a.prototype.setLocation=function(a){return geokod(a,d(function(b){return this.set({name:void 0,location:{address:b.formatted_address,lat:b.geometry.location.lat(),lng:b.geometry.location.lng(),accuracy:a.accuracy}})},this))},a.prototype.setAccuracy=function(a){return this.set({location:{address:this.getAddress(),lat:this.getLat(),lng:this.getLng(),accuracy:a}})},a.prototype.getLat=function(){return this.get("location").lat},a.prototype.getLng=function(){return this.get("location").lng},a.prototype.getAddress=function(){return this.get("name")||this.get("location").address},a.prototype.getAccuracy=function(){return this.get("location").accuracy},a.prototype.getLocationArr=function(){return[this.getLat(),this.getLng()]},a.prototype.getLocationString=function(){return this.getLat()+","+this.getLng()},a.prototype.GlatLng=function(a,b){a==null&&(a=0),b==null&&(b=0);return new google.maps.LatLng(this.getLat()+a,this.getLng()+b)};return a}(),n=function(){function a(){a.__super__.constructor.apply(this,arguments)}c(a,Backbone.Collection),a.prototype.model=m;return a}(),q=function(){function a(){a.__super__.constructor.apply(this,arguments)}c(a,n),a.prototype.url="https://api.foursquare.com/v2/checkins/recent?oauth_token="+localStorage.token+"&callback=?",a.prototype.parse=function(a){var b;if(a.meta.code===200){b=[],_(a.response.recent).map(function(a){var c;if(a.type==="checkin")try{c=_(b).detect(function(b){return b.name===a.venue.name}),c.here.push(a.user);if(c.lastSeen<a.createdAt)return c.lastSeen=a.createdAt}catch(d){return b.push({name:a.venue.name,location:a.venue.location,here:[a.user],lastSeen:a.createdAt})}});return b}return alert("foursquare hiba")};return a}(),p=function(){function a(){a.__super__.constructor.apply(this,arguments)}c(a,Backbone.View),a.prototype.tagName="li",a.prototype.className="venue",a.prototype.template=_.template($("#venueTemplate").html()),a.prototype.events={click:"action",mousedown:"toggle",mouseup:"toggle",touchstart:"toggle",touchend:"toggle"},a.prototype.toggle=function(){return $(this.el).toggleClass("clicked")},a.prototype.action=function(){_.extend(app.idemegyek,this.model);return window.location.hash="utvonal"},a.prototype.initialize=function(){return _.bindAll(this,"render")},a.prototype.render=function(){$(this.el).html(this.template(this.model.toJSON()));return this};return a}(),o=function(){function a(){a.__super__.constructor.apply(this,arguments)}c(a,Backbone.View),a.prototype.el=$("#venuesList"),a.prototype.initialize=function(){_.bindAll(this,"render");return this.model.bind("refresh",this.render)},a.prototype.addVenueToList=function(a){var b;b=new p({model:a});return this.$("#venuesList ul").append(b.render().el)},a.prototype.render=function(){$(this.el).html("<ul id='venues'></ul>"),this.model.each(this.addVenueToList),$("time.timeago").timeago();return this};return a}(),k=function(){function a(){a.__super__.constructor.apply(this,arguments)}c(a,Backbone.View),a.prototype.initialize=function(a){_.bindAll(this,"render"),this.model.bind("change",this.render),this.map=a.map,this.marker=new google.maps.Marker({map:this.map,draggable:!0});return google.maps.event.addListener(this.marker,"dragend",d(function(a){return this.model.setLocation({lat:a.latLng.lat(),lng:a.latLng.lng()})},this))},a.prototype.render=function(){this.marker.setPosition(this.model.GlatLng());return this.marker.setTitle(this.model.getAddress())};return a}(),l=function(){function a(){a.__super__.constructor.apply(this,arguments)}c(a,k),a.prototype.initialize=function(b){this.markerImage=new google.maps.MarkerImage("img/potty.png",new google.maps.Size(16,16),new google.maps.Point(0,0),new google.maps.Point(5,5));return a.__super__.initialize.call(this,b)},a.prototype.render=function(){this.marker.setIcon(this.markerImage);try{this.map.getBounds().contains(this.model.GlatLng())&&this.map.setCenter(this.model.GlatLng())}catch(b){console.error(b)}return a.__super__.render.apply(this,arguments)};return a}(),f=function(){function a(){a.__super__.constructor.apply(this,arguments)}c(a,k),a.prototype.initialize=function(b){return a.__super__.initialize.call(this,b)},a.prototype.render=function(){try{this.infobubble.close()}catch(b){!0}this.infobubble=new InfoBubble({content:"<a href='#utvonal'>"+this.model.getAddress()+"</a>",padding:10,backgroundColor:"rgb(57,57,57)",maxwidth:"300px",arrowSize:10,hideCloseButton:!0,backgroundClassName:"phoney",disableAutoPan:!0}),this.infobubble.open(this.map,this.marker),google.maps.event.addListener(this.marker,"dragstart",d(function(a){return this.infobubble.close()},this)),google.maps.event.addListener(this.marker,"dragend",d(function(a){return this.infobubble.setContent("<a href='#utvonal'>"+this.model.getAddress()+"</a>")},this)),this.marker.setIcon("img/pin.png");return a.__super__.render.apply(this,arguments)};return a}(),j=function(){function a(){a.__super__.constructor.apply(this,arguments)}c(a,Backbone.View),a.prototype.mapId="map_canvas",a.prototype.initialize=function(){_.bindAll(this,"render"),this.map=new google.maps.Map(document.getElementById(this.mapId),{center:this.collection.at(0).GlatLng(),zoom:13,mapTypeId:google.maps.MapTypeId.ROADMAP}),this.mylocationmarker=new l({model:app.ittvagyok,map:this.map}),this.destinationmarker=new f({model:app.idemegyek,map:this.map}),google.maps.event.addListener(this.map,"click",d(function(a){return this.destinationmarker.model.setLocation({lat:a.latLng.lat(),lng:a.latLng.lng()})},this)),$("#"+this.mapId).css({height:window.innerHeight-48+"px"});return $(window).bind(e.call(window,"onorientation")>=0?"orientationchange":"resize",d(function(){return $("#"+this.mapId).css({height:window.innerHeight-48+"px"})},this))},a.prototype.render=function(){this.mylocationmarker.render();try{return this.destinationmarker.render()}catch(a){}};return a}(),i=function(){function a(){a.__super__.constructor.apply(this,arguments)}c(a,Backbone.View),a.prototype.initialize=function(){_.bindAll(this,"render","updateDestination","getRoute");return this.model.bind("change",this.render)},a.prototype.render=function(){return $(this.el).find("input").val(this.model.getAddress())},a.prototype.events={submit:"updateLocation"},a.prototype.updateLocation=function(){this.model.setLocation({address:$(this.el).find("input").val()});return window.location.hash="utvonal"};return a}(),h=function(){function a(){a.__super__.constructor.apply(this,arguments)}c(a,Backbone.View),a.prototype.initialize=function(){_.bindAll(this,"render");return this.model.bind("change",this.render)},a.prototype.events={click:"edit"},a.prototype.render=function(){return $(this.el).html(this.model.getAddress())},a.prototype.edit=function(){var a;a=prompt("hol vagy?",this.model.getAddress());if(a)return this.model.setLocation({address:a})};return a}(),g=function(){function a(){a.__super__.constructor.apply(this,arguments)}c(a,Backbone.View),a.prototype.el=$("#utvonaldoboz"),a.prototype.template=_.template($("#routeTemplate").html()),a.prototype.initialize=function(){},a.prototype.render=function(){return planRoute({from:this.collection.at(0).getLocationArr(),to:this.collection.at(1).getLocationArr()},d(function(a){$(this.el).html(this.template({name:this.collection.at(1).getAddress(),route:a.m_arrMains[0]})),pageLoading(1),mozogj("#masodiklepes");return localStorage.utvonal=$(this.el).html()},this),function(a){alert("oda már nem jár a bkv"),delete localStorage.utvonal;return pageLoading(1)})};return a}(),b=function(){function b(){b.__super__.constructor.apply(this,arguments)}c(b,Backbone.Controller),b.prototype.routes={"":"foursquareFriends","access_token=:token":"saveToken","error=:err":"foursquareError",deleteToken:"deleteToken",barataim:"foursquareFriends",terkep:"map",utvonal:"bkvRoute"},b.prototype.saveToken=function(a){localStorage.token=a,app.venues.url=app.venues.url.replace("undefined",a);return window.location.hash="barataim"},b.prototype.deleteToken=function(){delete localStorage.token;return window.location.hash=""},b.prototype.foursquareError=function(a){alert(a);return window.location.hash=""},b.prototype.foursquareFriends=function(){mozogj("#elsolepes");if(typeof debug!="undefined"&&debug!==null||localStorage.token){pageLoading();return app.venues.fetch({success:function(){return pageLoading("done")}})}try{return $("#foursquare").html(_.template($("#loginTemplate").html(),{client_id:a[window.location.host]}))}catch(b){return alert("nem találtam megfelelő foursquare kulcsot.")}},b.prototype.map=function(){mozogj("#map"),app.terkepnezet||(app.terkepnezet=new j({collection:app.ketpoi}));if(!app.terkepnezet.mylocationmarker.marker.getPosition())return app.terkepnezet.render()},b.prototype.bkvRoute=function(){try{app.dirview.render();return pageLoading()}catch(a){if(localStorage.utvonal!=null){console.log("van útvonal cache-ben"),$("#utvonaldoboz").html(localStorage.utvonal);return mozogj("#masodiklepes")}return window.location.hash="#"}};return b}(),window.goldenRatio=function(a){return a-a/1.6803},window.pageLoading=function(a){var b;if(a!=null)return document.body.removeChild(document.getElementById("a"));b=$('<div class="loading" id="a"><img src="img/loading.gif"></div>'),b.css({position:"absolute",left:$("body").width()/2-30+"px",top:window.pageYOffset+goldenRatio(window.innerHeight)+"px"});return $("body").append(b)},window.historyStack=[],window.mozogj=function(a){var b,c,d;b=["#elsolepes","#map","#masodiklepes"],c=$(".current").first(),d="#"+c.attr("id");if(0<b.indexOf(a)-b.indexOf(d)){$(c).removeClass("current").addClass("reverse");return $(a).addClass("current")}$(c).removeClass("current");return $(a).removeClass("reverse").addClass("current")},window.app={},app.ittvagyok=new m({location:{address:"()",lat:47.494319,lng:19.059984}}),app.idemegyek=new m,app.ketpoi=new n([app.ittvagyok,app.idemegyek]),app.venues=new q,app.venueslist=new o({model:app.venues}),app.dirview=new g({collection:app.ketpoi}),app.ittvagyokdoboz=new h({el:$("#ittvagyok"),model:app.ittvagyok}),app.idemegyekdoboz=new i({el:$("#quickbox"),model:app.idemegyek}),app.controller=new b,Backbone.history.start(),$.os.ios&&$("body").addClass("ios"),$.os.android&&$("body").addClass("android"),navigator.geolocation.getCurrentPosition(function(a){return app.ittvagyok.setLocation({lat:a.coords.latitude,lng:a.coords.longitude,accuracy:a.coords.accuracy})},function(a){return app.ittvagyokdoboz.edit()},{enableHighAccuracy:!0});return $(applicationCache).bind("updateReady",function(){if(confirm("Frissítés elérhető az alkalmazáshoz. Töltsem le most?")){window.applicationCache.update(),window.applicationCache.swapCache();return window.location.reload()}})})}).call(this)